services:
  astro:
    build:
      context: .
      dockerfile: Dockerfile

    working_dir: /workspace
    tty: true
    stdin_open: true


    # プロジェクト本体を bind mount（双方向）
    volumes:
      - .:/workspace:cached

      # 依存キャッシュは Docker volume に隔離（汚染防止）
      - node_modules:/workspace/node_modules
      - astro_cache:/workspace/.astro
      - pnpm_store:/workspace/.pnpm-store

    ports:
      - "4321:4321"

    command: ["sleep", "infinity"]

volumes:
  node_modules:
  astro_cache:
  pnpm_store:
